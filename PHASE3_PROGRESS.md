# フェーズ3: ハンズフリーUIの構築 - 進捗管理

**期間**: Week 5-6  
**開始日**: ___________  
**完了予定日**: ___________  
**ステータス**: 🔵 未開始 / 🟡 進行中 / 🟢 完了

---

## 目標

ボタンを押さなくていいように、マイクを常時ONにし、ブラウザのVADで制御するUIを作る。AIが話している最中にユーザーが話し始めたら、AIが即座に停止するインタラプト機能を実装する。

---

## タスクリスト

### 1. VAD実装
- [ ] Silero VADモデルのダウンロード
  - [ ] モデルファイル (`silero_vad.onnx`) の取得
  - [ ] `public/models/` ディレクトリに配置
- [ ] ONNX Runtimeのセットアップ
  - [ ] `onnxruntime-web` パッケージのインストール
  - [ ] Web Workerのセットアップ
- [ ] Web WorkerでのVAD処理実装
  - [ ] `app/workers/vad.worker.ts` の作成
  - [ ] モデルのロード処理
  - [ ] 音声チャンクの処理ロジック
- [ ] 発話検知・終了検知の実装
  - [ ] 発話開始の検知 (閾値: 0.5)
  - [ ] 発話終了の検知 (300msの沈黙)
  - [ ] メインスレッドへの通知

**メモ**:  
_________________________________________________  
_________________________________________________  

### 2. インタラプト機能
- [ ] ユーザー発話検知時の音声停止
  - [ ] VAD検知イベントのハンドリング
  - [ ] `AudioContext.stop()` の実装
  - [ ] 現在再生中の音声ソースの切断
- [ ] サーバー側のストリーミングキャンセル
  - [ ] WebSocket経由でキャンセルメッセージ送信
  - [ ] Groqストリーミングのキャンセル
  - [ ] Cartesiaストリーミングのキャンセル
- [ ] 状態リセット
  - [ ] 会話コンテキストのクリア
  - [ ] UI状態のリセット
- [ ] 新規処理開始
  - [ ] ユーザーの新しい発話の処理開始

**メモ**:  
_________________________________________________  
_________________________________________________  

### 3. UI改善
- [ ] マイク常時ON
  - [ ] マイクの自動起動
  - [ ] マイク権限の取得
  - [ ] マイク状態の表示
- [ ] 視覚的フィードバック
  - [ ] 波形アニメーションの実装
  - [ ] 発話中の視覚的表示
  - [ ] AI応答中の視覚的表示
  - [ ] 待機中の表示
- [ ] 会話履歴表示
  - [ ] チャットUIの実装
  - [ ] スクロール可能な履歴
  - [ ] メッセージの表示形式

**メモ**:  
_________________________________________________  
_________________________________________________  

### 4. テスト
- [ ] ハンズフリー操作の動作確認
- [ ] VADの精度テスト
- [ ] インタラプト機能のテスト
- [ ] UI/UXのテスト
- [ ] パフォーマンステスト

**メモ**:  
_________________________________________________  
_________________________________________________  

---

## 成果物

- [ ] ボタン不要のハンズフリー音声会話アプリ
- [ ] VADが正常に動作する
- [ ] インタラプト機能が正常に動作する
- [ ] 視覚的フィードバックが実装されている
- [ ] 動作確認のスクリーンショット/動画

---

## 技術的な詳細

### 使用技術
- Silero VAD v4
- ONNX Runtime Web
- Web Workers
- Web Audio API
- Canvas API (波形表示)
- React (UIコンポーネント)

### 実装ファイル
- `app/workers/vad.worker.ts` - VAD Web Worker
- `app/lib/vad.ts` - VADユーティリティ
- `app/components/Waveform.tsx` - 波形ビジュアライザー
- `app/components/ConversationHistory.tsx` - 会話履歴
- `app/hooks/useVAD.ts` - VADフック
- `public/models/silero_vad.onnx` - VADモデル

### VAD設定パラメータ
- **発話開始閾値**: 0.5
- **発話終了閾値**: 0.3
- **沈黙継続時間**: 300ms
- **サンプリングレート**: 16kHz
- **チャンクサイズ**: 512サンプル (32ms)

### インタラプト設定
- **検知から停止まで**: 100ms以下
- **音声停止**: 即座 (10ms以内)
- **サーバーキャンセル**: 50ms以内

---

## パフォーマンス目標

| 指標 | 目標値 | 実測値 | 達成状況 |
|------|--------|--------|----------|
| VAD検知遅延 | 50ms | _____ | [ ] |
| インタラプト遅延 | 100ms | _____ | [ ] |
| CPU使用率 | 20%以下 | _____ | [ ] |
| メモリ使用量 | 200MB以下 | _____ | [ ] |

---

## UI/UX要件

### 視覚的フィードバック
- [ ] マイクON/OFF状態の表示
- [ ] ユーザー発話中のアニメーション
- [ ] AI応答中の波形アニメーション
- [ ] 待機中の静かな状態表示
- [ ] エラー状態の表示

### アクセシビリティ
- [ ] キーボード操作対応
- [ ] スクリーンリーダー対応 (ARIAラベル)
- [ ] 色のコントラスト (WCAG AA準拠)

---

## 課題・ブロッカー

| 日付 | 課題 | 解決策 | ステータス |
|------|------|--------|-----------|
|      |      |        |           |
|      |      |        |           |

---

## 学習メモ

### Silero VAD関連
_________________________________________________  
_________________________________________________  

### ONNX Runtime Web関連
_________________________________________________  
_________________________________________________  

### Web Workers関連
_________________________________________________  
_________________________________________________  

### Web Audio API関連
_________________________________________________  
_________________________________________________  

### Canvas API関連
_________________________________________________  
_________________________________________________  

---

## 完了チェックリスト

- [ ] すべてのタスクが完了
- [ ] VADが正常に動作する
- [ ] インタラプト機能が正常に動作する
- [ ] UI/UXが完成している
- [ ] パフォーマンス目標を達成
- [ ] テストがパスした
- [ ] ドキュメントが更新された
- [ ] 次のフェーズへの引き継ぎ準備ができた

---

## 完了日

**実際の完了日**: ___________

---

## 次のフェーズへの引き継ぎ事項

_________________________________________________  
_________________________________________________  
_________________________________________________  

