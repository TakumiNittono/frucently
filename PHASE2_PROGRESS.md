# フェーズ2: 最速の「耳と口」を接続 - 進捗管理

**期間**: Week 3-4  
**開始日**: 2025-01-XX  
**完了予定日**: ___________  
**ステータス**: 🟡 進行中

---

## 目標

音声認識 (STT) と音声合成 (TTS) を統合し、エンドツーエンドで音声会話が動作することを確認する。

---

## 実装オプション選択

- [ ] オプションA: オーケストレーター使用 (Vapi.ai / Retell AI) - **推奨**
- [x] オプションB: 直接統合 (カスタム実装)

**選択理由**:  
より柔軟性が高く、学習価値が高いため、直接統合（オプションB）で実装を進めます。Deepgram（STT）とCartesia（TTS）を直接統合し、Groqと組み合わせてパイプラインを構築します。  

---

## オプションA: オーケストレーター使用 (推奨)

### 1. Vapi/Retellアカウント作成
- [ ] Vapi.ai または Retell AI のアカウント作成
- [ ] ダッシュボードの確認
- [ ] APIキーの取得

**メモ**:  
_________________________________________________  
_________________________________________________  

### 2. 設定
- [ ] STT: Deepgram (Nova-2) の設定
- [ ] LLM: Groq (Llama 3.1 70B) の設定
- [ ] TTS: Cartesia (Sonic-multilingual) の設定
- [ ] 言語: 日本語の設定
- [ ] その他のパラメータ調整

**メモ**:  
_________________________________________________  
_________________________________________________  

### 3. API統合
- [ ] Vapi/RetellのWebSocket APIをNext.jsに統合
- [ ] WebSocket接続の実装
- [ ] 音声入力の実装 (マイク)
- [ ] 音声出力の実装 (スピーカー)
- [ ] エラーハンドリング

**メモ**:  
_________________________________________________  
_________________________________________________  

### 4. テスト
- [ ] エンドツーエンドで会話動作確認
- [ ] 遅延測定
- [ ] 音質確認
- [ ] エラーケースのテスト

**メモ**:  
_________________________________________________  
_________________________________________________  

---

## オプションB: 直接統合 (カスタム実装)

### 1. Deepgram統合
- [x] Deepgramアカウント作成・APIキー取得（ユーザー側で実施）
- [x] REST API接続の実装（`/api/stt`）
- [x] 音声ファイル送信の実装
- [x] テキストストリーム受信の実装
- [x] エラーハンドリング

**メモ**:  
Deepgram STT API統合を完了しました。`app/api/stt/route.ts`で音声ファイルをテキストに変換する機能を実装済みです。Nova-2モデルを使用し、日本語対応しています。  

### 2. Cartesia統合
- [x] Cartesiaアカウント作成・APIキー取得（ユーザー側で実施）
- [x] REST API接続の実装（`/api/tts`）
- [x] テキスト送信の実装
- [x] 音声ストリーム受信の実装
- [x] エラーハンドリング

**メモ**:  
Cartesia TTS API統合を完了しました。`app/api/tts/route.ts`でテキストを音声に変換する機能を実装済みです。Sonic-multilingualモデルを使用し、PCM形式で音声を返します。  

### 3. パイプライン統合
- [x] 基本パイプライン構造の実装（Groq統合済み）
- [x] Deepgram → Groq → Cartesia の接続（基本実装完了）
- [x] データフローの実装
- [x] 音声チャットUIの実装（`VoiceChat.tsx`）
- [ ] リアルタイムストリーミング接続（フェーズ5で最適化予定）

**メモ**:  
パイプライン統合を完了しました。`app/components/VoiceChat.tsx`で音声録音→STT→LLM→TTS→音声再生のフローを実装済みです。現在はバッチ処理ですが、基本的な動作は確認できます。  

### 4. テスト
- [ ] 各段階での動作確認
- [ ] エンドツーエンドテスト
- [ ] 遅延測定
- [ ] エラーケースのテスト

**メモ**:  
_________________________________________________  
_________________________________________________  

---

## 成果物

- [x] 音声会話が動作するアプリ（基本実装完了）
- [ ] 動作確認のスクリーンショット/動画
- [ ] テスト結果の記録
- [ ] 遅延測定結果

---

## 技術的な詳細

### 使用技術
- Next.js 14+ (App Router)
- WebSocket (Socket.io または ネイティブWebSocket)
- Web Audio API
- Deepgram API (オプションBの場合)
- Cartesia API (オプションBの場合)
- Vapi.ai / Retell AI (オプションAの場合)

### 実装ファイル
- `app/api/stt/route.ts` - Deepgram STT API統合 ✅
- `app/api/tts/route.ts` - Cartesia TTS API統合 ✅
- `app/api/voice/route.ts` - Groq LLM API統合 ✅
- `app/api/groq/route.ts` - GroqストリーミングAPI ✅
- `app/components/VoiceChat.tsx` - 音声チャットUI ✅
- `app/hooks/useAudioRecorder.ts` - 音声録音フック ✅
- `app/hooks/useAudioPlayer.ts` - 音声再生フック ✅

### API仕様
- **WebSocketエンドポイント**: `/api/websocket`
- **メッセージ形式**: JSON
- **音声フォーマット**: PCM, 16kHz, 16bit, mono

---

## パフォーマンス目標

| 指標 | 目標値 | 実測値 | 達成状況 |
|------|--------|--------|----------|
| STT遅延 | 100ms | _____ | [ ] |
| LLM TTFT | 200ms | _____ | [ ] |
| TTS遅延 | 100ms | _____ | [ ] |
| エンドツーエンド | 500ms | _____ | [ ] |

---

## 課題・ブロッカー

| 日付 | 課題 | 解決策 | ステータス |
|------|------|--------|-----------|
|      |      |        |           |
|      |      |        |           |

---

## 学習メモ

### WebSocket実装関連
_________________________________________________  
_________________________________________________  

### Web Audio API関連
_________________________________________________  
_________________________________________________  

### Deepgram/Cartesia API関連
- Deepgram SDK (`@deepgram/sdk`) を使用してSTT APIを実装
- Nova-2モデルで日本語音声認識を実現
- Cartesia REST APIを直接呼び出してTTSを実装
- Sonic-multilingualモデルで日本語音声合成を実現
- PCM形式で音声データを返す実装を完了  

### Vapi/Retell関連
_________________________________________________  
_________________________________________________  

---

## 完了チェックリスト

- [x] すべてのタスクが完了（基本実装）
- [x] 成果物が確認できた（API統合完了）
- [ ] テストがパスした（動作確認待ち）
- [ ] パフォーマンス目標を達成（最適化はフェーズ5で実施）
- [x] ドキュメントが更新された（API_GUIDE.md作成）
- [x] 次のフェーズへの引き継ぎ準備ができた

**注意**: リアルタイムストリーミングの最適化はフェーズ5で実施予定です。

---

## 完了日

**実際の完了日**: ___________

---

## 次のフェーズへの引き継ぎ事項

_________________________________________________  
_________________________________________________  
_________________________________________________  

